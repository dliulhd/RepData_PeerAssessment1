---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r}
unzip("activity.zip")
df <- read.csv(unzip("activity.zip",list = TRUE)[1,1])
df_REDUCE <- df[!is.na(df$steps),]
LVS <- levels(df_REDUCE$date)

MEDIAN <- AVERAGE <- TOTAL_STEPS <- vector(mode = "numeric", length = length(LVS))

```

## What is mean total number of steps taken per day?

* Calculating the total, average, and median values of number of steps taken every single day, and group them in one single data frame
```{r, echo = "TRUE", output = "asis"}
for(i in 1:length(LVS)) { 
  TOTAL_STEPS[i] = sum(df_REDUCE[df_REDUCE$date == LVS[i],]$steps, na.rm = TRUE) 
  AVERAGE[i] = mean(df_REDUCE[df_REDUCE$date == LVS[i],]$steps,na.rm = TRUE) 
  MEDIAN[i] = median(df_REDUCE[df_REDUCE$date == LVS[i],]$steps, na.rm = TRUE) 
} # Calculating the total, average, and median values of number of steps taken every single day

df_daily_statistics <- data.frame(Dates = as.Date(LVS, "%Y-%m-%d"), Total_steps = TOTAL_STEPS, Average = AVERAGE, Median = MEDIAN) # Group these results into a single data frame
```

* Histogram of daily total number of steps

```{r}
cutting.points = seq(0, max(df_daily_statistics$Total_steps), length.out = 10)
hist(df_daily_statistics$Total_steps, col = "lightblue", xlab = "total number of steps each day", main = "Histogram of daily total number of steps",breaks= cutting.points)
```


* Reporting the results

```{r}
print(df_daily_statistics)
```

## What is the average daily activity pattern?

* Computing the average numbers of steps in specific 5-min intervals, averaged over all available days
```{r}

INTERVALS <- seq(0,max(df$interval,na.rm = TRUE), by = 5)
Ave_interval_steps <- vector(mode = "numeric", length = length(INTERVALS))
for(i in 1:length(INTERVALS)) {
  Ave_interval_steps[i] <- mean( df$steps[df$interval == INTERVALS[i]] , na.rm = TRUE)
}
```

* Plotting the the average numbers of steps in specific 5-min intervals, against the intervals
```{r}
plot(1:length(INTERVALS),Ave_interval_steps,type ="l",xlab = "5-minute intervals", ylab = "Average number of steps")
```


* Reporting the interval with maximum average number of steps

```{r}
MAX <- round( max(Ave_interval_steps, na.rm = TRUE),4) 
MAX_ind <- which.max(Ave_interval_steps)
message("The 5-minute interval with maximum average number of steps is [",MAX_ind*5-5,",",MAX_ind*5,").", " with the maximum value ",MAX,"." , sep="")
```


## Imputing missing values


```{r}
NAS <- is.na(df$steps) # Create a vector marking the location of NA's, where the indices of TRUE's are the indices of the rows with missing step numbers (step = NA)
sum(NAS) # Obtaining total number of TRUE's, ie, the total number of rows with NA in the data frame
```

* Fill NA's with the average value of that 5-minute interval across all days, and save the result in a new data frame named df_noNA

```{r}
STP_NoNA <- df$steps

for(i in 1:length(STP_NoNA)){
  if(is.na(STP_NoNA[i]) & !is.nan(Ave_interval_steps[df$interval[i]/5+1] )) STP_NoNA[i] <- Ave_interval_steps[df$interval[i]/5+1]
}

df_NoNA <- data.frame( steps = STP_NoNA, df[,2:3] )
```

* Compute the total, average, and median values of the number of steps of each day

```{r}
MEDIAN2 <- AVERAGE2 <- TOTAL_STEPS2 <- vector(mode = "numeric", length = length(LVS))

for(i in 1:length(LVS)) { 
  TOTAL_STEPS2[i] = sum(df_NoNA[df_NoNA$date == LVS[i],]$steps) 
  AVERAGE2[i] = mean(df_NoNA[df_NoNA$date == LVS[i],]$steps) 
  MEDIAN2[i] = median(df_NoNA[df_NoNA$date == LVS[i],]$steps) 
} # Calculating the total, average, and median values of number of steps taken every single day
```

* Plot the histogram with filled-in missing values

```{r}
hist(TOTAL_STEPS2, col = "blue", xlab = "total number of steps each day", main = "Histogram of daily total number of steps",breaks= cutting.points)
```


* Organizing the results obtained with filled-in missing values into a data frame, and report the result
```{r}
df_daily_statistics2 <- data.frame(Dates = as.Date(LVS, "%Y-%m-%d"), Total_steps = TOTAL_STEPS2, Average = AVERAGE2, Median = MEDIAN2) # Group these results into a single data frame

df_daily_statistics2
```

## Are there differences in activity patterns between weekdays and weekends?

* Creating the vector indicating whether a row is Weekday or Weekend 

```{r}
Days <- weekdays(as.Date(df_NoNA$date, "%Y-%m-%d"))

for(i in 1:length(Days)) {
  if(Days[i]=="Samedi" | Days[i]=="Dimanche") Days[i] <- "Weekend"
  else Days[i] <- "Weekday"
}
Days <- factor(Days)

Ave_interval_steps_WD <- Ave_interval_steps_WE <- vector(mode = "numeric", length = length(INTERVALS))
for(i in 1:length(INTERVALS)) {
  Ave_interval_steps_WD[i] <- mean( df_NoNA$steps[(df_NoNA$interval == INTERVALS[i])&(Days=="Weekday")] , na.rm = TRUE)
  Ave_interval_steps_WE[i] <- mean( df_NoNA$steps[(df_NoNA$interval == INTERVALS[i])&(Days=="Weekend")] , na.rm = TRUE)
}
```

```{r, fig.height=}
par(mfrow=c(2,1))
plot(1:length(INTERVALS),Ave_interval_steps_WD,xlab="",ylab="Av. Num. of Steps",main="Weekdays",type="l")
plot(1:length(INTERVALS),Ave_interval_steps_WD,xlab="5-minute intervals",ylab="Av. Num. of Steps",main="Weekends",type="l")
```
